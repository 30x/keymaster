error_log /dev/stderr;
error_log error.log info;
worker_processes auto;

pid /usr/local/var/run/gozerian.pid;

events {
  worker_connections 256;
}

http {
  tcp_nopush on;
  tcp_nodelay on;
  keepalive_timeout 5;

  lua_package_path "./lua/?.lua;;;";

  init_worker_by_lua_block {
    libgozerian = require('lua-gozerian')
      -- pipes are assigned to yaml config urls (may be file: or http: refs)
      local pipes = {
        bundle1_dump = 'file:///Users/sganyo/dev/gatekeeper/pipes/dump.yaml',
        bundle1_apikey = 'file:///Users/sganyo/dev/gatekeeper/pipes/apikey.yaml',
        bundle2_dump = 'file:///Users/sganyo/dev/gatekeeper/pipes/dump.yaml',
        bundle2_apikey = 'file:///Users/sganyo/dev/gatekeeper/pipes/apikey.yaml',
      }
      libgozerian.init(pipes)
  }

  include bundle1.conf;
  include bundle2.conf;
}
